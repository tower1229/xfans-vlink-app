---
description: 电子商务系统数据库设计最佳实践，确保数据完整性、性能和可扩展性。
globs: app/api/prisma/*, app/api/utils/redis.mjs
alwaysApply: false
---
---
description: 电子商务系统数据库设计最佳实践，确保数据完整性、性能和可扩展性。
globs: app/api/prisma/*, app/api/utils/redis.mjs
alwaysApply: false
---

# 电子商务数据库设计最佳实践

## 数据模型设计
- 设计规范化的数据模型，减少数据冗余
- 在适当情况下进行反规范化，提高查询性能
- 使用合适的数据类型，优化存储空间
- 实现实体间的清晰关系，使用适当的外键约束

## 索引策略
- 为频繁查询的字段创建索引
- 为外键创建索引，优化连接操作
- 避免过度索引，平衡查询性能和写入性能
- 定期分析和优化索引使用情况

## 查询优化
- 编写高效的查询，避免全表扫描
- 使用查询计划分析工具优化复杂查询
- 实现适当的分页和筛选机制
- 避免 N+1 查询问题，使用批量查询或连接

## 事务和并发
- 实现适当的事务隔离级别
- 设计避免死锁的数据访问模式
- 使用乐观锁或悲观锁处理并发更新
- 实现重试机制处理事务冲突

## 数据迁移和版本控制
- 使用迁移工具管理数据库架构变更
- 实现向后兼容的迁移策略
- 为每次迁移编写回滚计划
- 在测试环境验证迁移脚本

## 数据安全
- 实现行级和列级的访问控制
- 加密敏感数据，如密码和支付信息
- 实现数据脱敏，保护个人身份信息
- 定期备份数据，实现灾难恢复计划

## 性能和扩展性
- 实现数据分区策略，处理大量数据
- 考虑读写分离，优化读取性能
- 实现缓存层，减少数据库负载
- 设计支持水平扩展的数据模型

## 电子商务特定模型
- 设计灵活的产品目录模型，支持多种产品类型
- 实现库存管理模型，支持实时库存跟踪
- 设计订单处理模型，支持完整的订单生命周期
- 实现客户数据模型，支持个性化和客户关系管理